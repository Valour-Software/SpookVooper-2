@using SV2.Database;
@using SV2.Database.Models.Districts;
@model SV2.Database.Models.Districts.Province

@{ 
    if (Model != null)
    {
        ViewData["Title"] = Model.Name;
    }
}

<head>
    <meta property="og:title" content="@Model.Name">
    <meta name="keywords" content="SpookVooper, Vooperia, Districts, Government">
    <meta property="og:description" content="@Model.Description">
    <meta property="og:url" content="https://spookvooper.com/District/View/@Model.Name">
    <style>
        .tooltip-dontshow {
            opacity: 0 !important;
        }
        .mergedrow {
            width: 25em;
            line-height: 1.2em;
        }
        .dividertop {
            border-top: 1px solid darkgray;
        }
        .infobox {
            border: 1px solid darkgray;
            background-color: rgba(255, 255, 255, 0.1);
            max-width: 300px;
        }
        .infobox-header div {
            text-align: center;
        }
        .infobox-subheader div {
            text-align: center;
        }
        .infobox-row-name {
            padding: 0 0.6em 0.2em 0.6em;
        }

        .mergedrow th {
            
        }
    </style>
</head>

<!-- Main row for page -->
<div class="d-flex flex-row align-content-center" style="width:100%">
    <!-- Leftmost column -->
    <div class="p-2 flex-shrink-1 ms-auto"></div>

    <!-- Center column -->
    <div class="p-4" style="width:80em">

        @await Html.PartialAsync("_StatusMessage", TempData["StatusMessage"])
        @{
            if (Model is not null)
            {
                SVUser? user = UserManager.GetUser(Context);

                <div class="d-flex align-content-center align-items-center">
                    <div style="display:inline-block; margin:2em;margin-left: auto;margin-right: auto;">
                        <h2 style="text-align:center" class="display-4">The Province of</h2>
                        <h1 style="text-align:center" class="display-3">@Model.Name</h1>
                    </div>
                </div>

                if (Model.Description is not null)
                {
                    <h1 style="text-align:center">Description</h1>
                    <div style="margin-left:auto;margin-right:auto;max-width: 70%;width: fit-content;">
                        @Html.Raw(MarkdownManager.GetHtml(Model.Description))
                    </div>
                }

                if (user is not null && Model.District.GovernorId == user.Id)
                {
                    <center>
                        <a asp-route-id="@Model.Id" asp-action="Edit" asp-controller="Province" class="btn btn-primary">Modify</a>
                    </center>
                }
            } 
            else
            {
                <h1 style="text-align:center" class="display-4">District not found!</h1>
            }
        }
    </div>

    <!-- Rightmost column -->
    <div class="p-4 flex-shrink-1 me-auto" style="margin-top: 2em;">
        <table class="infobox">
            <tbody>
                <tr>
                    <th colspan="2" class="infobox-header">
                        <div>@Model.Name, @Model.District.Name</div>
                   </th>
                </tr>
                <tr>
                    <td colspan="2" class="infobox-subheader">
                        <div>Province</div>
                    </td>
                </tr>
                <tr class="mergedrow dividertop">
                    <th class="infobox-row-name">District</th>
                    <td class="infobox-row-value"><a href="/District/View/@Model.District.Name">@Model.District.Name</a></td>
                </tr>
                <tr class="mergedrow">
                    <th class="infobox-row-name">State</th>
                    <td class="infobox-row-value">None</td>
                </tr>
                <tr class="mergedrow">
                    <th class="infobox-row-name">Population</th>
                    <td class="infobox-row-value">@($"{Model.Population:n0}")</td>
                </tr>
                <tr class="mergedrow">
                    <th class="infobox-row-name">Development Value</th>
                    <td class="infobox-row-value">@($"{Model.DevelopmentValue:n0}")</td>
                </tr>
                <tr class="mergedrow">
                    <th class="infobox-row-name">Development Stage</th>
                    <td class="infobox-row-value">@Model.CurrentDevelopmentStage.Name</td>
                </tr>
                <tr class="mergedrow">
                    <th class="infobox-row-name">Building Slots</th>
                    <td class="infobox-row-value">@($"{Model.BuildingSlots:n0}")</td>
                </tr>
                <tr class="mergedrow">
                    <th class="infobox-row-name">Building Slots Used</th>
                    <td class="infobox-row-value">@($"{Model.GetBuildings().Sum(x => x.Size):n0}")</td>
                </tr>
                @if (Model.GetOverpopulationModifier() > 0.001)
                {
                    <tr class="mergedrow dividertop">
                        <th class="infobox-row-name">Overpopulation Modifier</th>
                        <td class="infobox-row-value">@($"+{Math.Round(Model.GetOverpopulationModifier()*100, 2)}%") to death rate</td>
                    </tr>
                }
                <tr class="mergedrow dividertop">
                    <th class="infobox-row-name">Monthly (Est.) Growth</th>
                    @if (Model.GetOverpopulationModifier() > 0.001) {
                        <td class="infobox-row-value">@($"{(Model.GetMonthlyPopulationGrowth() * 1.1):n0}")</td>
                    }
                    else
                    {
                        <td class="infobox-row-value">@($"{(Math.Max(Model.GetMonthlyPopulationGrowth() * 1.1, 24*30)):n0}")</td>
                    }
                </tr>
                <tr class="mergedrow dividertop">
                    <th class="infobox-row-name">Monthly (Est.) Migration</th>
                    <td class="infobox-row-value">@($"{Model.MonthlyEstimatedMigrants:n0}")</td>
                </tr>
                <tr class="mergedrow">
                    <th class="infobox-row-name">Migration Attraction</th>
                    <td class="infobox-row-value">@($"{Model.MigrationAttraction:n0}")</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = []
    for (i = 0; i < tooltipTriggerList.length;i++) {
        el = tooltipTriggerList[i]
        e = new bootstrap.Tooltip(el)
        tooltipList.push(e)
    }
</script>